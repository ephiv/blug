<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>blug</title>
    <!-- Prism.js CSS for syntax highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            line-height: 1.6;
            color: #1a1a1a;
            background-color: #d7d7de;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        header {
            border-bottom: 2px solid #445767;
            padding-bottom: 20px;
            margin-bottom: 40px;
            position: relative;
        }

        h1 {
            font-size: 2rem;
            font-weight: normal;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .subtitle {
            font-size: 0.9rem;
            margin-top: 10px;
            color: #8d937f;
        }

        .auth-section {
            position: absolute;
            top: 0;
            right: 0;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .auth-input {
            padding: 5px 10px;
            border: 1px solid #445767;
            background-color: #bdbccb;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
        }

        .auth-button, .create-button, .editor-button {
            padding: 5px 15px;
            border: 1px solid #445767;
            background-color: #bdbccb;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .auth-button:hover, .create-button:hover, .editor-button:hover {
            background-color: #eeddff;
        }

        .auth-status {
            font-size: 0.8rem;
            color: #8d937f;
        }

        .create-section {
            display: none;
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #445767;
            background-color: #bdbccb;
        }

        .create-section.visible {
            display: block;
        }

        .editor-container {
            display: none;
            margin-top: 20px;
        }

        .editor-container.visible {
            display: block;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #445767;
            background-color: #d7d7de;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .form-textarea {
            width: 100%;
            min-height: 100px;
            padding: 10px;
            border: 1px solid #445767;
            background-color: #d7d7de;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            resize: vertical;
        }

        .editor-toolbar {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
            padding: 10px;
            border: 1px solid #445767;
            background-color: #bdbccb;
            flex-wrap: wrap;
        }

        .toolbar-button {
            padding: 5px 10px;
            border: 1px solid #445767;
            background-color: #d7d7de;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .toolbar-button:hover {
            background-color: #eeddff;
        }

        .editor-area {
            display: flex;
            gap: 20px;
        }

        .editor-pane, .preview-pane {
            flex: 1;
        }

        .editor-pane textarea {
            width: 100%;
            min-height: 300px;
            padding: 15px;
            border: 1px solid #445767;
            background-color: #d7d7de;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            resize: vertical;
            white-space: pre-wrap;
        }

        .preview-pane {
            border: 1px solid #445767;
            background-color: #d7d7de;
            padding: 15px;
            height: 300px;
            overflow-y: auto;
        }

        .preview-label, .editor-label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .json-output {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #445767;
            background-color: #bdbccb;
        }

        .json-textarea {
            width: 100%;
            min-height: 150px;
            padding: 10px;
            border: 1px solid #445767;
            background-color: #d7d7de;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            resize: vertical;
        }

        .copy-button {
            margin-top: 10px;
            padding: 8px 15px;
            border: 1px solid #445767;
            background-color: #d7d7de;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .copy-button:hover {
            background-color: #eeddff;
        }

        .post-preview {
            border: 1px solid #445767;
            margin-bottom: 20px;
            cursor: pointer;
            transition: background-color 0.2s;
            background-color: #bdbccb;
        }

        .post-preview:hover {
            background-color: #eeddff;
        }

        .post-header {
            padding: 20px;
            border-bottom: 1px solid #445767;
        }

        .post-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .post-date {
            font-size: 0.8rem;
            color: #8d937f;
        }

        .post-excerpt {
            padding: 20px 20px 20px;
            color: #8d937f;
        }

        .post-content {
            display: none;
            padding: 20px;
            border-top: 1px solid #445767;
            background-color: #d7d7de;
        }

        .post-content.expanded {
            display: block;
        }

        .expand-indicator {
            float: right;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .no-posts {
            text-align: center;
            color: #8d937f;
            font-style: italic;
            padding: 40px;
            border: 1px solid #445767;
            background-color: #bdbccb;
        }

        /* Markdown content styling */
        .post-content h1, .preview-pane h1,
        .post-content h2, .preview-pane h2,
        .post-content h3, .preview-pane h3,
        .post-content h4, .preview-pane h4,
        .post-content h5, .preview-pane h5,
        .post-content h6, .preview-pane h6 {
            margin: 20px 0 10px;
            font-weight: bold;
        }

        .post-content h1, .preview-pane h1 {
            font-size: 1.5rem;
            border-bottom: 2px solid #445767;
            padding-bottom: 5px;
        }

        .post-content h2, .preview-pane h2 {
            font-size: 1.3rem;
            border-bottom: 1px solid #445767;
            padding-bottom: 3px;
        }

        .post-content p, .preview-pane p {
            margin-bottom: 15px;
        }

        .post-content ul, .preview-pane ul,
        .post-content ol, .preview-pane ol {
            margin: 15px 0 15px 20px;
        }

        .post-content li, .preview-pane li {
            margin-bottom: 5px;
        }

        .post-content blockquote, .preview-pane blockquote {
            border-left: 3px solid #445767;
            padding-left: 15px;
            margin: 15px 0;
            color: #8d937f;
            font-style: italic;
        }

        .post-content code, .preview-pane code {
            background-color: #bdbccb;
            padding: 2px 4px;
            font-family: 'Courier New', monospace;
            border: 1px solid #8d937f;
        }

        .post-content pre, .preview-pane pre {
            background-color: #bdbccb;
            padding: 15px;
            border: 1px solid #8d937f;
            overflow-x: auto;
            margin: 15px 0;
        }

        .post-content pre code, .preview-pane pre code {
            background: none;
            border: none;
            padding: 0;
        }

        .post-content a, .preview-pane a {
            color: #445767;
            text-decoration: underline;
        }

        .post-content a:hover, .preview-pane a:hover {
            background-color: #1a1a1a;
            color: #d7d7de;
        }

        .post-content strong, .preview-pane strong {
            font-weight: bold;
        }

        .post-content em, .preview-pane em {
            font-style: italic;
        }

        .post-content hr, .preview-pane hr {
            border: none;
            border-top: 1px solid #445767;
            margin: 20px 0;
        }

        /* Override Prism.js styles to match your actual color scheme */
        code[class*="language-"],
        pre[class*="language-"] {
            color: #111111 !important;
            background: none !important;
            text-shadow: none !important;
            font-family: 'Courier New', monospace !important;
            font-size: inherit !important;
            line-height: 1.5 !important;
        }

        pre[class*="language-"] {
            padding: 15px !important;
            margin: 15px 0 !important;
            overflow: auto !important;
            background-color: #f8f4f0 !important;
            border: 1px solid #aaa39e !important;
        }

        /* Token colors using your palette + interpolated colors */
        .token.comment,
        .token.prolog,
        .token.doctype,
        .token.cdata {
            color: #aaa39e !important;
            background: none !important;
            font-style: italic !important;
        }

        .token.punctuation {
            color: #5c524c !important;
            background: none !important;
        }

        .token.property,
        .token.tag,
        .token.boolean,
        .token.number,
        .token.constant,
        .token.symbol,
        .token.deleted {
            color: #981d34 !important;
            background: none !important;
        }

        .token.selector,
        .token.attr-name,
        .token.string,
        .token.char,
        .token.builtin,
        .token.inserted {
            color: #7a3840 !important;
            background: none !important;
        }

        .token.operator,
        .token.entity,
        .token.url,
        .language-css .token.string,
        .style .token.string {
            color: #5c524c !important;
            background: none !important;
        }

        .token.atrule,
        .token.attr-value,
        .token.keyword {
            color: #551723 !important;
            background: none !important;
            font-weight: bold !important;
        }

        .token.function,
        .token.class-name {
            color: #7a3840 !important;
            background: none !important;
            font-weight: bold !important;
        }

        .token.regex,
        .token.important,
        .token.variable {
            color: #981d34 !important;
            background: none !important;
        }

        /* Python-specific tokens */
        .language-python .token.keyword {
            color: #551723 !important;
        }

        .language-python .token.function {
            color: #7a3840 !important;
        }

        .language-python .token.builtin {
            color: #981d34 !important;
        }

        /* C/C++ specific tokens */
        .language-c .token.keyword,
        .language-cpp .token.keyword {
            color: #551723 !important;
        }

        .language-c .token.function,
        .language-cpp .token.function {
            color: #7a3840 !important;
        }

        .language-c .token.directive,
        .language-cpp .token.directive {
            color: #981d34 !important;
        }

        /* Remove any highlighting backgrounds */
        .token.operator,
        .token.punctuation,
        .token.important {
            background: none !important;
        }

        /* Inline code styling - keep the bright yellowish highlight */
        .post-content code:not([class*="language-"]),
        .preview-pane code:not([class*="language-"]) {
            background-color: #f3e4d7 !important;
            color: #111111 !important;
            padding: 2px 4px !important;
            font-family: 'Courier New', monospace !important;
            border: 1px solid #aaa39e !important;
        }

        /* Plain code blocks (no language specified) - no background modifications */
        .post-content pre:not([class*="language-"]),
        .preview-pane pre:not([class*="language-"]) {
            background-color: #bdbccb !important; /* Use your original code block color */
            border: 1px solid #8d937f !important; /* Use your original border color */
            padding: 15px !important;
            margin: 15px 0 !important;
            overflow-x: auto !important;
        }

        .post-content pre:not([class*="language-"]) code,
        .preview-pane pre:not([class*="language-"]) code {
            background: none !important;
            border: none !important;
            padding: 0 !important;
            color: #1a1a1a !important; /* Use your original text color */
        }

        .loading {
            text-align: center;
            color: #8d937f;
            padding: 40px;
        }

        .error {
            text-align: center;
            color: #8d937f;
            padding: 40px;
            border: 1px solid #445767;
            background-color: #bdbccb;
        }

        @media (max-width: 768px) {
            .auth-section {
                position: static;
                margin-top: 20px;
                justify-content: flex-start;
                flex-wrap: wrap;
            }

            .editor-area {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>blug</h1>
            <p class="subtitle">a minimal blog (im too lazy to make a real one)</p>

            <div class="auth-section">
                <div id="auth-form">
                    <input type="password" id="password-input" class="auth-input" placeholder="enter password">
                    <button id="auth-button" class="auth-button">login</button>
                </div>
                <div id="auth-status" class="auth-status" style="display: none;"></div>
            </div>
        </header>

        <div id="create-section" class="create-section">
            <h3>create new post</h3>
            <button id="toggle-editor" class="create-button">start writing</button>

            <div id="editor-container" class="editor-container">
                <div class="form-group">
                    <label class="form-label" for="post-id">id:</label>
                    <input type="text" id="post-id" class="form-input" placeholder="enter post id (or leave blank for auto)">
                </div>

                <div class="form-group">
                    <label class="form-label" for="post-title">title:</label>
                    <input type="text" id="post-title" class="form-input" placeholder="enter post title">
                </div>

                <div class="form-group">
                    <label class="form-label" for="post-excerpt">excerpt:</label>
                    <textarea id="post-excerpt" class="form-textarea" placeholder="brief preview of your post..."></textarea>
                </div>

                <div class="editor-toolbar">
                    <button class="toolbar-button" data-action="bold">**bold**</button>
                    <button class="toolbar-button" data-action="italic">*italic*</button>
                    <button class="toolbar-button" data-action="strikethrough">~~strike~~</button>
                    <button class="toolbar-button" data-action="code">`code`</button>
                    <button class="toolbar-button" data-action="link">[link](url)</button>
                    <button class="toolbar-button" data-action="h1"># h1</button>
                    <button class="toolbar-button" data-action="h2">## h2</button>
                    <button class="toolbar-button" data-action="quote">> quote</button>
                    <button class="toolbar-button" data-action="list">- list</button>
                    <button class="toolbar-button" data-action="codeblock">```code```</button>
                </div>

                <div class="editor-area">
                    <div class="editor-pane">
                        <label class="editor-label">markdown editor:</label>
                        <textarea id="markdown-editor" placeholder="write your post in markdown..."></textarea>
                    </div>
                    <div class="preview-pane">
                        <label class="preview-label">live preview:</label>
                        <div id="markdown-preview"></div>
                    </div>
                </div>

                <div class="json-output">
                    <h4>generated json (copy this to add to posts.json):</h4>
                    <textarea id="json-output" class="json-textarea" readonly></textarea>
                    <button id="copy-json" class="copy-button">copy to clipboard</button>
                </div>
            </div>
        </div>

        <main id="blog-posts">
            <div class="loading">...</div>
        </main>
    </div>

    <!-- Prism.js script for syntax highlighting -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>

    <script type="module">
        import { marked } from 'https://cdnjs.cloudflare.com/ajax/libs/marked/16.2.0/lib/marked.esm.js';

        // Simple password (change this to whatever you want)
        const OWNER_PASSWORD = 'pascalstriangle35601111';

        let isAuthenticated = false;
        let posts = [];

        // DOM elements
        const passwordInput = document.getElementById('password-input');
        const authButton = document.getElementById('auth-button');
        const authForm = document.getElementById('auth-form');
        const authStatus = document.getElementById('auth-status');
        const createSection = document.getElementById('create-section');
        const toggleEditorBtn = document.getElementById('toggle-editor');
        const editorContainer = document.getElementById('editor-container');
        const postsContainer = document.getElementById('blog-posts');

        // Editor elements
        const postIdInput = document.getElementById('post-id');
        const postTitleInput = document.getElementById('post-title');
        const postExcerptInput = document.getElementById('post-excerpt');
        const markdownEditor = document.getElementById('markdown-editor');
        const markdownPreview = document.getElementById('markdown-preview');
        const jsonOutput = document.getElementById('json-output');
        const copyJsonBtn = document.getElementById('copy-json');

        // Configure marked
        marked.setOptions({
            breaks: true,
            gfm: true
        });

        // Authentication
        authButton.addEventListener('click', handleAuth);
        passwordInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') handleAuth();
        });

        function handleAuth() {
            const password = passwordInput.value;

            if (password === OWNER_PASSWORD) {
                isAuthenticated = true;
                authForm.style.display = 'none';
                authStatus.style.display = 'block';
                authStatus.textContent = 'authenticated as owner';
                createSection.classList.add('visible');
            } else {
                alert('incorrect password');
                passwordInput.value = '';
            }
        }

        // Editor functionality
        toggleEditorBtn.addEventListener('click', () => {
            editorContainer.classList.toggle('visible');
            toggleEditorBtn.textContent = editorContainer.classList.contains('visible')
                ? 'hide editor' : 'start writing';
        });

        // Toolbar buttons
        document.querySelectorAll('.toolbar-button').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const action = e.target.getAttribute('data-action');
                insertMarkdown(action);
            });
        });

        function insertMarkdown(action) {
            const editor = markdownEditor;
            const start = editor.selectionStart;
            const end = editor.selectionEnd;
            const selectedText = editor.value.substring(start, end);
            let replacement = '';

            switch (action) {
                case 'bold':
                    replacement = `**${selectedText || 'bold text'}**`;
                    break;
                case 'italic':
                    replacement = `*${selectedText || 'italic text'}*`;
                    break;
                case 'strikethrough':
                    replacement = `~~${selectedText || 'strikethrough text'}~~`;
                    break;
                case 'code':
                    replacement = `\`${selectedText || 'code'}\``;
                    break;
                case 'link':
                    replacement = `[${selectedText || 'link text'}](url)`;
                    break;
                case 'h1':
                    replacement = `# ${selectedText || 'heading'}`;
                    break;
                case 'h2':
                    replacement = `## ${selectedText || 'heading'}`;
                    break;
                case 'quote':
                    replacement = `> ${selectedText || 'quote'}`;
                    break;
                case 'list':
                    replacement = `- ${selectedText || 'list item'}`;
                    break;
                case 'codeblock':
                    replacement = `\`\`\`\n${selectedText || 'code here'}\n\`\`\``;
                    break;
            }

            editor.value = editor.value.substring(0, start) + replacement + editor.value.substring(end);
            editor.focus();

            // Update preview
            updatePreview();
        }

        // Live preview update
        markdownEditor.addEventListener('input', updatePreview);
        postIdInput.addEventListener('input', updateJsonOutput);
        postTitleInput.addEventListener('input', updateJsonOutput);
        postExcerptInput.addEventListener('input', updateJsonOutput);

        function updatePreview() {
            const markdown = markdownEditor.value;
            markdownPreview.innerHTML = marked.parse(markdown);
            // Apply syntax highlighting to preview with a small delay
            setTimeout(() => {
                Prism.highlightAllUnder(markdownPreview);
            }, 50);
            updateJsonOutput();
        }

        function updateJsonOutput() {
            const customId = postIdInput.value.trim();
            const title = postTitleInput.value.trim();
            const excerpt = postExcerptInput.value.trim();
            const content = markdownEditor.value.trim();

            if (!title && !excerpt && !content) {
                jsonOutput.value = '';
                return;
            }

            const postId = customId || generateId();
            const currentDate = new Date().toISOString().split('T')[0];

            const postObject = {
                id: postId,
                title: title || 'untitled post',
                date: currentDate,
                excerpt: excerpt || 'no excerpt provided',
                content: content || '# empty post\n\nno content yet...'
            };

            jsonOutput.value = JSON.stringify(postObject, null, 2);
        }

        function generateId() {
            const maxId = posts.length > 0 ? Math.max(...posts.map(p => parseInt(p.id))) : 0;
            return (maxId + 1).toString();
        }

        // Copy to clipboard
        copyJsonBtn.addEventListener('click', async () => {
            try {
                await navigator.clipboard.writeText(jsonOutput.value);
                const originalText = copyJsonBtn.textContent;
                copyJsonBtn.textContent = 'copied!';
                setTimeout(() => {
                    copyJsonBtn.textContent = originalText;
                }, 2000);
            } catch (err) {
                alert('failed to copy to clipboard');
            }
        });

        // Blog posts functionality
        async function loadPosts() {
            try {
                const response = await fetch('./posts.json');

                if (!response.ok) {
                    throw new Error('Failed to load posts');
                }

                posts = await response.json();
                renderPosts(posts);
            } catch (error) {
                console.error('Error loading posts:', error);
                showError();
            }
        }

        function renderPosts(posts) {
            if (!posts || posts.length === 0) {
                showNoPosts();
                return;
            }

            const postsHtml = posts.map(post => createPostHTML(post)).join('');
            postsContainer.innerHTML = postsHtml;

            // Apply syntax highlighting to all code blocks after rendering
            setTimeout(() => {
                Prism.highlightAllUnder(postsContainer);
            }, 100);

            // Add click handlers for post expansion
            document.querySelectorAll('.post-preview').forEach(preview => {
                preview.addEventListener('click', togglePost);
            });
        }

        function createPostHTML(post) {
            const date = new Date(post.date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });

            return `
                <article class="post-preview" data-id="${post.id}">
                    <div class="post-header">
                        <h2 class="post-title">${escapeHtml(post.title)}</h2>
                        <div class="post-date">${date}</div>
                        <span class="expand-indicator">+</span>
                    </div>
                    <div class="post-excerpt">
                        ${escapeHtml(post.excerpt)}
                    </div>
                    <div class="post-content" id="content-${post.id}">
                        ${marked.parse(post.content)}
                    </div>
                </article>
            `;
        }

        function togglePost(event) {
            const preview = event.currentTarget;
            const content = preview.querySelector('.post-content');
            const indicator = preview.querySelector('.expand-indicator');

            if (content.classList.contains('expanded')) {
                content.classList.remove('expanded');
                indicator.textContent = '+';
            } else {
                content.classList.add('expanded');
                indicator.textContent = '−';
                // Apply syntax highlighting when post is expanded
                Prism.highlightAllUnder(content);
            }
        }

        function showNoPosts() {
            postsContainer.innerHTML = `
                <div class="no-posts">
                    No posts available. Create a posts.json file with your blog posts.
                </div>
            `;
        }

        function showError() {
            postsContainer.innerHTML = `
                <div class="error">
                    <h3>Unable to load posts</h3>
                    <p>Make sure posts.json exists in the same directory as this HTML file.</p>
                    <p>Example posts.json structure:</p>
                    <pre>[
  {
    "id": "1",
    "title": "My First Post",
    "date": "2025-08-23",
    "excerpt": "This is a preview of my first post...",
    "content": "# Hello World\\n\\nThis is my **first** blog post!"
  }
]</pre>
                </div>
            `;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Load posts when page loads
        loadPosts();
    </script>
</body>
</html>
